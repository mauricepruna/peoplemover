{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "UserController",
        "requires": [
            "Ext.util.JSON",
            "Ext.MessageBox"
        ]
    },
    "name": "MyController1",
    "designerId": "074a0b64-631d-4879-95e8-b763b3ef6e7e",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "mainview #showLoginButton",
                "designer|targetType": "Ext.Button",
                "fn": "showLogin",
                "implHandler": [
                    "",
                    "        var loginForm = Ext.create('widget.loginform'),\t// Login form",
                    "            mainView = this.getMainView();\t\t\t\t// Main view",
                    "",
                    "        // Navigate to login",
                    "        mainView.push({",
                    "            xtype: \"loginform\",",
                    "            title: \"Login\"",
                    "        });",
                    ""
                ],
                "name": "tap"
            },
            "name": "showLogin",
            "designerId": "efc06f99-c96c-42f5-a57b-a7d42a23e07d"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "mainview #showRegisterButton",
                "designer|targetType": "Ext.Button",
                "fn": "showRegister",
                "implHandler": [
                    "",
                    "        var loginForm = Ext.create('widget.registerform'),\t// Login form",
                    "            mainView = this.getMainView();\t\t\t\t// Main view",
                    "",
                    "        // Navigate to login",
                    "        mainView.push({",
                    "            xtype: \"registerform\",",
                    "            title: \"Register\"",
                    "        });",
                    ""
                ],
                "name": "tap"
            },
            "name": "showRegister",
            "designerId": "5e291268-d4b1-4abd-9705-be36d731dc64"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "mainview #aboutUs",
                "designer|targetType": "Ext.Button",
                "fn": "showAboutUs",
                "implHandler": [
                    "",
                    "                var reportProblem = Ext.create('widget.aboutus'),\t// Login form",
                    "                    mainView = this.getMainView();\t\t\t\t// Main view",
                    "",
                    "                // Navigate to login",
                    "                mainView.push({",
                    "                    xtype: \"aboutus\",",
                    "                    title: \"About Us\"",
                    "                });",
                    ""
                ],
                "name": "tap"
            },
            "name": "showAboutUs",
            "designerId": "9e3dcf4d-d753-4411-8fd8-1658c9f51959"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "mainview #reportProblem",
                "designer|targetType": "Ext.Button",
                "fn": "showReportProblem",
                "implHandler": [
                    "",
                    "        var reportProblem = Ext.create('widget.problem'),\t// Login form",
                    "            mainView = this.getMainView();\t\t\t\t// Main view",
                    "",
                    "        // Navigate to login",
                    "        mainView.push({",
                    "            xtype: \"problem\",",
                    "            title: \"Report a Problem\"",
                    "        });",
                    ""
                ],
                "name": "tap"
            },
            "name": "showReportProblem",
            "designerId": "665cc345-67f3-4882-900b-aad4b1c40900"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "mainview #requestStop",
                "designer|targetType": "Ext.Button",
                "fn": "showRequestStop",
                "implHandler": [
                    "",
                    "        var reportProblem = Ext.create('widget.requestStop'),\t// Login form",
                    "            mainView = this.getMainView();\t\t\t\t// Main view",
                    "",
                    "        // Navigate to login",
                    "        mainView.push({",
                    "            xtype: \"requestStop\",",
                    "            title: \"Request Stop\"",
                    "        });",
                    ""
                ],
                "name": "tap"
            },
            "name": "showRequestStop",
            "designerId": "c657688d-85a8-4a12-b498-520ab056b948"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "mainview #feedback",
                "designer|targetType": "Ext.Button",
                "fn": "showRequestFeedback",
                "implHandler": [
                    "",
                    "        var reportProblem = Ext.create('widget.feedback'),\t// Login form",
                    "            mainView = this.getMainView();\t\t\t\t// Main view",
                    "",
                    "        // Navigate to login",
                    "        mainView.push({",
                    "            xtype: \"feedback\",",
                    "            title: \"Enter Feedback\"",
                    "        });",
                    ""
                ],
                "name": "tap"
            },
            "name": "showRequestFeedback",
            "designerId": "5894e61d-3fef-4689-90d9-a6fc816790ae"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "mainview #serviceTimes",
                "designer|targetType": "Ext.Button",
                "fn": "showServiceTimes",
                "implHandler": [
                    "",
                    "        var reportProblem = Ext.create('widget.servicetimes'),\t// Login form",
                    "            mainView = this.getMainView();\t\t\t\t// Main view",
                    "",
                    "        // Navigate to login",
                    "        mainView.push({",
                    "            xtype: \"servicetimes\",",
                    "            title: \"Service Times\"",
                    "        });",
                    ""
                ],
                "name": "tap"
            },
            "name": "showServiceTimes",
            "designerId": "f951e199-5548-4934-8134-a0433eb829e6"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "loginform #loginButton",
                "designer|targetType": "Ext.Button",
                "fn": "login",
                "implHandler": [
                    "    var form = button.up('formpanel'),\t\t\t// Login form",
                    "                \tvalues = form.getValues(),\t\t\t\t// Form values",
                    "                    mainView = this.getMainView();\t\t\t// Main view",
                    "                \t//loginPanel = this.getLoginPanel(),\t\t// Login and register buttons",
                    "                \t//welcomePanel = this.getWelcomePanel();\t// Welcome panel",
                    "",
                    "                // Success",
                    "                var successCallback = function(resp, ops) {",
                    "",
                    "                //     // Go back",
                    "                //     mainView.pop();",
                    "",
                    "                //     // Hide login panel",
                    "                //     loginPanel.hide();",
                    "",
                    "                //     // Show welcome panel",
                    "                //     welcomePanel.show();",
                    "",
                    "",
                    "",
                    "                    var jsonResp = Ext.JSON.decode(resp.responseText);",
                    "",
                    "                         if(jsonResp.message!==\"No Match\"){",
                    "                             var alert = Ext.getCmp(\"alertfield\");",
                    "                             if(jsonResp.code===\"admin\")",
                    "                              {",
                    "",
                    "                                  alert.setReadOnly(false);",
                    "                              }",
                    "                             else",
                    "                              {",
                    "                                  alert.setReadOnly(true);",
                    "                              }",
                    "                              Ext.Msg.alert(\"Info\",\"Login Successful\");",
                    "",
                    "                             localStorage.setItem('ppmtoken',jsonResp.message);",
                    "",
                    "                             var mybutton = Ext.create('widget.esttimeview').down('#bfavorite');",
                    "                                mybutton.setText('Save as Favorite');",
                    "                                mybutton.enable();",
                    "",
                    "                               //get back",
                    "                                mainView.pop();",
                    "",
                    "                        //     // Hide login panel",
                    "                                form.hide();",
                    "                     }",
                    "                     else",
                    "                         {",
                    "                            var token  = localStorage.getItem(\"ppmtoken\");",
                    "                            if(token!==null){",
                    "                                localStorage.removeItem(\"ppmtoken\");",
                    "                            }",
                    "",
                    "                             Ext.Msg.alert(\"Info\",jsonResp.message);",
                    "                         }",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "",
                    "                };",
                    "",
                    "                // Failure",
                    "                var failureCallback = function(resp, ops) {",
                    "",
                    "",
                    "",
                    "                   var jsonResp = Ext.JSON.decode(resp.responseText);",
                    "",
                    "                    Ext.Msg.alert(\"Info\",\"message: \"+jsonResp.message);",
                    "                   //button.setDisabled(false);",
                    "                };",
                    "",
                    "",
                    "                //button.setText('Please wait ...');",
                    "                //button.setDisabled(true);",
                    "                var enctext = CryptoJS.MD5(values.password);",
                    "",
                    "                // TODO: Login using server-side authentication service",
                    "                Ext.Ajax.request({",
                    "                \t\turl: \"http://pm-dev.cs.fiu.edu:8080/ppmws/userauth\",",
                    "                        method: 'POST',",
                    "                        /*headers: { 'Content-Type': 'application/json' },*/",
                    "                    params: {\"islogin\":true,",
                    "                             \"email\":values.email,",
                    "                             \"pass\":String(enctext)",
                    "                            },",
                    "                \t\tsuccess: successCallback,",
                    "                \t\tfailure: failureCallback",
                    "                 });",
                    ""
                ],
                "name": "tap"
            },
            "name": "login",
            "designerId": "de8838e8-891d-4696-94de-b30244831302"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "registerform #registerButton",
                "designer|targetType": "Ext.Button",
                "fn": "register",
                "implHandler": [
                    "  var form = button.up('formpanel'),\t\t\t// Login form",
                    "                \tvalues = form.getValues(),\t\t\t\t// Form values",
                    "                    mainView = this.getMainView();\t\t\t// Main view",
                    "                \t//loginPanel = this.getLoginPanel(),\t\t// Login and register buttons",
                    "                \t//welcomePanel = this.getWelcomePanel();\t// Welcome panel",
                    "",
                    "                // Success",
                    "                var successCallback = function(resp, ops) {",
                    "",
                    "                //     // Go back",
                    "                //     mainView.pop();",
                    "",
                    "                //     // Hide login panel",
                    "                //     loginPanel.hide();",
                    "",
                    "                //     // Show welcome panel",
                    "                //     welcomePanel.show();",
                    "",
                    "",
                    "                    var jsonResp = Ext.JSON.decode(resp.responseText);",
                    "                       Ext.Msg.alert(\"Info\",\"Registration Successful\");",
                    "",
                    "                     localStorage.setItem('ppmtoken',jsonResp.message);",
                    "",
                    "                    //get back",
                    "                         mainView.pop();",
                    "",
                    "                //     // Hide login panel",
                    "                     form.hide();",
                    "",
                    "",
                    "                };",
                    "",
                    "                // Failure",
                    "                var failureCallback = function(resp, ops) {",
                    "",
                    "                   var jsonResp = Ext.JSON.decode(resp.responseText);",
                    "                              Ext.Msg.alert(\"Info\",\"message:\"+jsonResp.message);",
                    "",
                    "",
                    "",
                    "                };",
                    "                //TODO: Registration using server-side authentication service",
                    "",
                    "                     var pass1 = values.password;",
                    "                     var pass2 = values.confirmation;",
                    "",
                    "",
                    "                         if (pass1 != pass2)",
                    "                             return Ext.Msg.alert(\"Info\",\"errorMessage: \"+\"Passwords do not match!\");",
                    "",
                    "                         else",
                    "                             {",
                    "                             var enctext = CryptoJS.MD5(values.password);",
                    "",
                    "",
                    "                                    Ext.Ajax.request({",
                    "                                        url: \"http://pm-dev.cs.fiu.edu:8080/ppmws/userauth\",",
                    "                                        method: 'POST',",
                    "                                        /*headers: { 'Content-Type': 'application/json' },*/",
                    "                                        params: {",
                    "                                            \"islogin\":false,",
                    "                                             \"email\":values.email,",
                    "                                             \"pass\": String(enctext)",
                    "                                            },",
                    "                                        success: successCallback,",
                    "                                        failure: failureCallback",
                    "                                    });",
                    "                             }",
                    ""
                ],
                "name": "tap"
            },
            "name": "register",
            "designerId": "b1fe5278-1604-4750-850f-ea96b785598b"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "mainView",
                "selector": "mainview"
            },
            "name": "mainView",
            "designerId": "2fcce59c-98b0-4755-8ef9-f78eb6659df7"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "problem #itemPictureBox",
                "designer|targetType": "Ext.Img",
                "fn": "onImageTap",
                "implHandler": [
                    "  Ext.device.Camera.capture({",
                    "                    source: 'camera',",
                    "                    destination: 'data',",
                    "",
                    "                    success: function(imagedata) {",
                    "",
                    "                        var img = Ext.getCmp('pictureBox');",
                    "                        var attach = 'data:image/jpeg;base64,'+imagedata;",
                    "                        sessionStorage.setItem('image',attach);",
                    "                        img.setSrc(attach);",
                    "                        ",
                    "                    },",
                    "",
                    "                    failure: function() {",
                    "                        Ext.Msg.alert('Error', 'There was an error when acquiring the picture.');",
                    "                    },",
                    "                    scope: this",
                    "                });",
                    "        "
                ],
                "name": "tap"
            },
            "name": "onImageTap",
            "designerId": "447de26f-c37e-46bf-8799-f51e289b37f3"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "problem #bProbSubmit",
                "designer|targetType": "Ext.Button",
                "fn": "submitProb",
                "implHandler": [
                    "var form = button.up('formpanel'),",
                    "                values = form.getValues(),\t\t\t\t// Form values",
                    "                mainView = this.getMainView();",
                    "\t\t\t\t",
                    "",
                    "        // Success",
                    "                        var successCallback = function(resp, ops) {",
                    "",
                    "",
                    "",
                    "",
                    "                            var jsonResp = Ext.JSON.decode(resp.responseText);",
                    "                               Ext.Msg.alert(\"Info\",\"message:\"+jsonResp.message);",
                    "",
                    "",
                    "                            //get back",
                    "                                 mainView.pop();",
                    "",
                    "                        //     // Hide login panel",
                    "                             form.hide();",
                    "",
                    "",
                    "                        };",
                    "",
                    "                        // Failure",
                    "                        var failureCallback = function(resp, ops) {",
                    "",
                    "                           var jsonResp = Ext.JSON.decode(resp.responseText);",
                    "                                      Ext.Msg.alert(\"Info\",\"message:\"+jsonResp.message);",
                    "",
                    "",
                    "",
                    "                        };",
                    "                        //TODO: Registration using server-side authentication service",
                    "",
                    "",
                    "\t\t\t\t\t\t\t\t\t\tvar attach = sessionStorage.getItem(\"image\");",
                    "\t\t\t\t\t\t\t\t\t\tif(attach!==null){",
                    "\t\t\t\t\t\t\t\t\t\t\t",
                    "\t\t\t\t\t\t\t\t\t\tvar callparams = {",
                    "                                                    \"name\":values.nameBox,",
                    "                                                    \"type\": \"PROBLEM\",",
                    "                                                     \"email\":values.emailBox,",
                    "                                                     \"message\": values.infoBox,",
                    "                                                     \"attach\":attach",
                    "                                                     ",
                    "                                                    };",
                    "                                         }",
                    "                                         else",
                    "                                         {",
                    "\t\t\t\t\t\t\t\t\t\t\t var callparams = {",
                    "                                                    \"name\":values.nameBox,",
                    "                                                    \"type\": \"PROBLEM\",",
                    "                                                     \"email\":values.emailBox,",
                    "                                                     \"message\": values.infoBox",
                    "                                                     ",
                    "                                                    };",
                    "\t\t\t\t\t\t\t\t\t\t }",
                    "",
                    "                                            Ext.Ajax.request({",
                    "                                                url: \"http://pm-dev.cs.fiu.edu:8080/ppmws/sendemail\",",
                    "                                                /*url: \"http://192.168.0.101/sendemail\",*/",
                    "                                                method: 'POST',",
                    "                                                /*headers: { 'Content-Type': 'application/json' },*/",
                    "                                                params: callparams,",
                    "                                                success: successCallback,",
                    "                                                failure: failureCallback",
                    "                                            });"
                ],
                "name": "tap"
            },
            "name": "submitProb",
            "designerId": "9650b2ac-dbfc-470b-8bbb-c203b2e3fbf9"
        }
    ]
}